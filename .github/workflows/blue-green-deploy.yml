deploy:
  runs-on: ubuntu-latest
  needs: build

  steps:
    - name: Get Image Tag
      run: echo "TAG=${{ github.run_number }}" >> $GITHUB_ENV

    - name: Deploy to VPS
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.DO_HOST }}
        username: ${{ secrets.DO_USER }}
        key: ${{ secrets.DO_SSH_KEY }}
        script: |
          set -e
          echo "Conectado al servidor ðŸš€"
          cd /home/litzi/Blue-Green
          echo "Actualizando imagenes Docker ðŸ”„"
          docker compose pull
          echo "Ejecutando script Blue/Green automÃ¡tico"
          bash scripts/deploy.sh $TAG
